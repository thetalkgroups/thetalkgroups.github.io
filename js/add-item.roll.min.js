var EventEmitter=function(){function e(){this.nextId=0;this.subscribers=[]}e.prototype.subscribe=function(e){var t=this;var r=this.nextId;this.nextId+=1;if(this.value!==undefined){e(this.value)}this.subscribers.push({id:r,func:e});return function(){t.subscribers=t.subscribers.filter(function(e){var t=e.id;return t!==r})}};e.prototype.next=function(e){var t=this;this.value=e;this.subscribers.forEach(function(e){var r=e.func;return r(t.value)})};return e}();var config={apiKey:"AIzaSyAjSDRU_Sl8DbTftnDghDsZJsxlAEvQpxE",authDomain:"fir-auth-test-fe62c.firebaseapp.com",databaseURL:"https://fir-auth-test-fe62c.firebaseio.com"};var providers={google:new firebase.auth.GoogleAuthProvider,twitter:new firebase.auth.TwitterAuthProvider,facebook:new firebase.auth.FacebookAuthProvider};firebase.initializeApp(config);var UserService=function(){function e(){var e=this;this.user=new EventEmitter;if(!Object.keys(localStorage).find(function(e){return e.startsWith("firebase")})){this.user.next(null)}firebase.auth().onAuthStateChanged(function(t){var r=t.displayName,n=t.photoURL,i=t.email,o=t.uid;return e.user.next({id:o,name:r,photo:n,email:i})})}e.prototype.signIn=function(e){return firebase.auth().signInWithPopup(providers[e])};e.prototype.signOut=function(){this.user.next(null);return firebase.auth().signOut()};return e}();var clearItemsFromCahce=function(){return Object.keys(localStorage).filter(function(e){return e.startsWith("/item")}).forEach(function(e){return localStorage.removeItem(e)})};var userService=new UserService;var isParentOf=function(e,t){if(e.nodeName==="HTML")return false;if(e.matches(t))return true;return isParentOf(e.parentNode,t)};if("serviceWorker"in navigator){navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(function(e){console.log("service worker registered");e.onupdatefound=function(){console.log("new service worker found")}})}else{console.log("service worker is not supported :-(")}window.addEventListener("load",function(){var e=document.querySelector(".navigation");var t=document.querySelector(".header");var r=document.querySelector(".breadcrumb");var n=document.querySelector(".wrapper");var i=document.querySelector(".header__top-bar__open-nav-button");var o=document.querySelector(".navigation__close-nav-button");var a=document.querySelector(".header__top-bar__user-name");var u=document.querySelector(".header__top-bar__sign-in-button");var s=document.querySelector(".header__user");var c=document.querySelector(".header__user__name");var d=document.querySelector(".header__user__email");var l=document.querySelector(".header__user__photo");var f=document.querySelector(".header__user__sign-out-button");u.hidden=false;var v=function(){e.classList.add("open");setTimeout(function(){return document.addEventListener("click",h)})};var h=function(e){var t=e.target;if(isParentOf(t,".navigation"))return;m()};var m=function(){e.classList.remove("open");document.removeEventListener("click",h)};var p=72;var b=r||n;var g=16;var y=function(){var e=document.body.getBoundingClientRect().right*headerImageHWRatio;var r=e-p;var n=window.scrollY;if(n>r){t.style.top=-r+"px";b.style.marginTop=e+g+"px";t.classList.add("small")}else{b.removeAttribute("style");t.classList.remove("small")}};var _=function(e){if(!e){u.hidden=false;a.hidden=true;s.classList.add("not-signed-in")}else{u.hidden=true;a.hidden=false;s.classList.remove("not-signed-in");a.innerText=e.name;c.innerText=e.name;d.innerText=e.email;l.src=e.photo}};var S=true;var w=function(){s.hidden=false;if(S){setTimeout(function(){return document.addEventListener("click",E)});S=false}};var E=function(e){e.preventDefault();if(isParentOf(e.target,".header__user"))return;S=true;s.hidden=true;document.removeEventListener("click",E)};var L=function(){clearItemsFromCahce();E({target:document.body,preventDefault:function(){return null}});userService.signOut()};userService.user.subscribe(_);window.addEventListener("scroll",y);i.addEventListener("click",v);o.addEventListener("click",m);f.addEventListener("click",L);a.addEventListener("click",w)});var HOST="https://83.93.98.21:8000";var formToJson=function(e){var t=new FormData(e);var r={};t["forEach"](function(e,t){r[t]=e});return r};var addItem=function(e,t){return fetch(HOST+prefix,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:t},body:JSON.stringify(e)}).then(function(e){if(!e.ok){e.text().then(function(e){return console.error(e)});return}return e})};window.addEventListener("load",function(){var e=document.querySelector(".login-warning");var t=document.querySelector(".add-item");var r=t.querySelector(".fields");var n=document.querySelector(".error");var i=function(r){console.error(r);n.removeAttribute("hidden");e.setAttribute("hidden","");t.setAttribute("hidden","")};fields.forEach(function(e){var t=document.createElement("label");var n=document.createElement(e.type);t.innerText=e.name;t.setAttribute("for",e.name);n.id=e.name;n.name=e.name;n.required=e.required;r.appendChild(t);r.appendChild(n)});userService.user.subscribe(function(r){if(!r){t.setAttribute("hidden","");e.removeAttribute("hidden");return}t.removeAttribute("hidden");e.setAttribute("hidden","");var n=function(e){e.preventDefault();var n=formToJson(t);var i=Object.keys(n).filter(function(e){return e!=="title"}).reduce(function(e,t){e[t]=n[t];return e},{});var o={_id:undefined,permission:undefined,title:n["title"],user:{id:r.id,name:r.name,photo:r.photo},content:i,fields:fields.map(function(e){return e.name})};addItem(o,r.id).then(function(){return location.href=location.href.replace(/[\w-]+\.html$/,"")}).catch(function(e){return console.error(e)});return false};t.addEventListener("submit",n)})});