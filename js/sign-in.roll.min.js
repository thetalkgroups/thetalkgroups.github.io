var EventEmitter=function(){function e(){this.nextId=0;this.subscribers=[]}e.prototype.subscribe=function(e){var t=this;var r=this.nextId;this.nextId+=1;if(this.value!==undefined){e(this.value)}this.subscribers.push({id:r,func:e});return function(){t.subscribers=t.subscribers.filter(function(e){var t=e.id;return t!==r})}};e.prototype.next=function(e){var t=this;this.value=e;this.subscribers.forEach(function(e){var r=e.func;return r(t.value)})};return e}();var config={apiKey:"AIzaSyAjSDRU_Sl8DbTftnDghDsZJsxlAEvQpxE",authDomain:"fir-auth-test-fe62c.firebaseapp.com",databaseURL:"https://fir-auth-test-fe62c.firebaseio.com"};var providers={google:new firebase.auth.GoogleAuthProvider,twitter:new firebase.auth.TwitterAuthProvider,facebook:new firebase.auth.FacebookAuthProvider};firebase.initializeApp(config);var UserService=function(){function e(){var e=this;this.user=new EventEmitter;if(!Object.keys(localStorage).find(function(e){return e.startsWith("firebase")})){this.user.next(null)}firebase.auth().onAuthStateChanged(function(t){var r=t.displayName,n=t.photoURL,i=t.email,a=t.uid;return e.user.next({id:a,name:r,photo:n,email:i})})}e.prototype.signIn=function(e){return firebase.auth().signInWithPopup(providers[e])};e.prototype.signOut=function(){this.user.next(null);return firebase.auth().signOut()};return e}();var clearItemsFromCahce=function(){return Object.keys(localStorage).filter(function(e){return e.startsWith("/item")}).forEach(function(e){return localStorage.removeItem(e)})};var userService=new UserService;var isParentOf=function(e,t){if(e.nodeName==="HTML")return false;if(e.matches(t))return true;return isParentOf(e.parentNode,t)};if("serviceWorker"in navigator){navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(function(e){console.log("service worker registered");e.update()})}window.addEventListener("load",function(){var e=document.querySelector(".navigation");var t=document.querySelector(".header");var r=document.querySelector(".breadcrumb");var n=document.querySelector(".wrapper");var i=document.querySelector(".header__top-bar__open-nav-button");var a=document.querySelector(".navigation__close-nav-button");var o=document.querySelector(".header__top-bar__user-name");var u=document.querySelector(".header__top-bar__sign-in-button");var s=document.querySelector(".header__user");var c=document.querySelector(".header__user__name");var d=document.querySelector(".header__user__email");var v=document.querySelector(".header__user__photo");var l=document.querySelector(".header__user__sign-out-button");u.hidden=false;var f=function(){e.classList.add("open");setTimeout(function(){return document.addEventListener("click",h)})};var h=function(e){var t=e.target;if(isParentOf(t,".navigation"))return;m()};var m=function(){e.classList.remove("open");document.removeEventListener("click",h)};var b=72;var g=r||n;var p=16;var _=function(){var e=document.body.getBoundingClientRect().right*headerImageHWRatio;var r=e-b;var n=window.scrollY;if(n>r){t.style.top=-r+"px";g.style.marginTop=e+p+"px";t.classList.add("small")}else{g.removeAttribute("style");t.classList.remove("small")}};var y=function(e){if(!e){u.hidden=false;o.hidden=true;s.classList.add("not-signed-in")}else{u.hidden=true;o.hidden=false;s.classList.remove("not-signed-in");o.innerText=e.name;c.innerText=e.name;d.innerText=e.email;v.src=e.photo}};var S=true;var L=function(){s.hidden=false;if(S){setTimeout(function(){return document.addEventListener("click",k)});S=false}};var k=function(e){e.preventDefault();if(isParentOf(e.target,".header__user"))return;S=true;s.hidden=true;document.removeEventListener("click",k)};var E=function(){clearItemsFromCahce();k({target:document.body,preventDefault:function(){return null}});userService.signOut()};userService.user.subscribe(y);window.addEventListener("scroll",_);i.addEventListener("click",f);a.addEventListener("click",m);l.addEventListener("click",E);o.addEventListener("click",L)});window.addEventListener("load",function(){var e=document.querySelector(".sign-in__button.google");var t=document.querySelector(".sign-in__button.facebook");var r=document.querySelector(".sign-in__button.twitter");var n=function(e){clearItemsFromCahce();userService.signIn(e).then(function(){return history.back()})};e.addEventListener("click",function(){return n("google")});t.addEventListener("click",function(){return n("facebook")});r.addEventListener("click",function(){return n("twitter")})});