var EventEmitter=function(){function e(){this.nextId=0,this.subscribers=[]}return e.prototype.subscribe=function(e){var t=this,r=this.nextId;return this.nextId+=1,void 0!==this.value&&e(this.value),this.subscribers.push({id:r,func:e}),function(){t.subscribers=t.subscribers.filter(function(e){var t=e.id;return t!==r})}},e.prototype.next=function(e){var t=this;this.value=e,this.subscribers.forEach(function(e){var r=e.func;return r(t.value)})},e}(),firebaseAppScript=document.getElementById("firebase-app"),firebaseAuthScript=document.getElementById("firebase-auth"),providers,UserService=function(){function e(){var e=this;this.user=new EventEmitter,firebaseAuthScript.onload=function(){var t={apiKey:"AIzaSyAjSDRU_Sl8DbTftnDghDsZJsxlAEvQpxE",authDomain:"fir-auth-test-fe62c.firebaseapp.com",databaseURL:"https://fir-auth-test-fe62c.firebaseio.com"};providers={google:new firebase.auth.GoogleAuthProvider,twitter:new firebase.auth.TwitterAuthProvider,facebook:new firebase.auth.FacebookAuthProvider},firebase.initializeApp(t),console.log(Object.keys(localStorage)),firebase.auth().onAuthStateChanged(function(t){var r=t.displayName,n=t.photoURL,i=t.email,o=t.uid;return e.user.next({id:o,name:r,photo:n,email:i})})}}return e.prototype.signIn=function(e){return firebase.auth().signInWithPopup(providers[e])},e.prototype.signOut=function(){return this.user.next(null),firebase.auth().signOut()},e}(),clearItemsFromCahce=function(){return Object.keys(localStorage).filter(function(e){return e.startsWith("/item")}).forEach(function(e){return localStorage.removeItem(e)})},userService=new UserService,isParentOf=function(e,t){return"HTML"!==e.nodeName&&(!!e.matches(t)||isParentOf(e.parentNode,t))};"serviceWorker"in navigator?navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(function(e){console.log("service worker registered"),e.onupdatefound=function(){console.log("new service worker found")}}):console.log("service worker is not supported :-("),window.addEventListener("load",function(){var e=document.querySelector(".navigation"),t=document.querySelector(".header"),r=document.querySelector(".breadcrumb"),n=document.querySelector(".wrapper"),i=document.querySelector(".header__top-bar__open-nav-button"),o=document.querySelector(".navigation__close-nav-button"),s=document.querySelector(".header__top-bar__user-name"),u=document.querySelector(".header__top-bar__sign-in-button"),a=document.querySelector(".header__user"),c=document.querySelector(".header__user__name"),d=document.querySelector(".header__user__email"),m=document.querySelector(".header__user__photo"),l=document.querySelector(".header__user__sign-out-button"),h=document.querySelector(".header__img"),f=document.createElement("img");f.onload=function(){t.insertBefore(f,h),h.setAttribute("hidden","")},f.className="header__img big",f.src=headerImageSrc,u.hidden=!1;var v=function(){e.classList.add("open"),setTimeout(function(){return document.addEventListener("click",p)})},p=function(e){var t=e.target;isParentOf(t,".navigation")||_()},_=function(){e.classList.remove("open"),document.removeEventListener("click",p)},b=72,g=r||n,y=16,S=function(){var e=document.body.getBoundingClientRect().right*headerImageHWRatio,r=e-b,n=window.scrollY;n>r?(t.style.top=-r+"px",g.style.marginTop=e+y+"px",t.classList.add("small")):(g.removeAttribute("style"),t.classList.remove("small"))},E=function(e){e?(u.hidden=!0,s.hidden=!1,a.classList.remove("not-signed-in"),s.innerText=e.name,c.innerText=e.name,d.innerText=e.email,m.src=e.photo):(u.hidden=!1,s.hidden=!0,a.classList.add("not-signed-in"))},k=!0,w=function(){a.hidden=!1,k&&(setTimeout(function(){return document.addEventListener("click",q)}),k=!1)},q=function(e){e.preventDefault(),isParentOf(e.target,".header__user")||(k=!0,a.hidden=!0,document.removeEventListener("click",q))},L=function(){clearItemsFromCahce(),q({target:document.body,preventDefault:function(){return null}}),userService.signOut()};userService.user.subscribe(E),window.addEventListener("scroll",S),i.addEventListener("click",v),o.addEventListener("click",_),l.addEventListener("click",L),s.addEventListener("click",w),function(e,t,r,n,i,o,s){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,o=t.createElement(r),s=t.getElementsByTagName(r)[0],o.async=1,o.src=n,s.parentNode.insertBefore(o,s)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-85930130-1","auto"),ga("send","pageview")});var HOST="https://83.93.98.21:8000",removePermission=function(e,t){return fetch(HOST+"/users/remove/"+t,{method:"POST",headers:{Authorization:e}})},userItemTemplate,createUserItem=function(e,t,r,n){return function(i){var o=i.user,s=i._id,u=document.createElement("article");u.appendChild(userItemTemplate.content.cloneNode(!0));var a=u.querySelector(".user-item__photo"),c=u.querySelector(".user-item__name"),d=u.querySelector(".user-item__email"),m=u.querySelector(".user-item__button");return u.className="user-item",a.src=o.photo,c.innerHTML=o.name,d.innerHTML=o.email,r?(m.innerHTML=r,m.addEventListener("click",function(r){return n(e,s).then(function(){return location.reload()}).catch(t)})):m.setAttribute("hidden",""),u}},createKickedUserItem=function(e,t){return function(r){var n=r._id,i=r.user,o=r.releaseTime;if(!(Date.now()>=o)){var s=createUserItem(e,t,"remove kick",removePermission)({user:i,_id:n}),u=document.createElement("p");return u.className="user-item__release-time",u.innerHTML="released in: "+moment(o).fromNow(),s.appendChild(u),s}}},getUsers=function(e){return fetch(HOST+"/users/list",{headers:{Authorization:e}}).then(function(e){return e.ok?e.json():e.text().then(function(e){throw e})}).then(function(e){var t=[],r=[],n=[];return e.forEach(function(e){var i=e._id,o=e.user,s=e.permission,u=e.releaseTime;switch(s){case"admin":return void t.push({_id:i,user:o});case"kicked":return void r.push({_id:i,user:o,releaseTime:u});case"banned":return void n.push({_id:i,user:o})}}),{adminUsers:t,kickedUsers:r,bannedUsers:n}})};window.addEventListener("load",function(){var e=document.querySelector(".admin-list"),t=document.querySelector(".admin-list__admins"),r=document.querySelector(".admin-list__kicked"),n=document.querySelector(".admin-list__banned"),i=document.querySelector(".error"),o=document.querySelector(".error__message");userItemTemplate=document.getElementById("user-item");var s=function(){},u=function(t){console.error(t),i.removeAttribute("hidden"),o.innerHTML=t.constructor.name.endsWith("Error")?t.message:t.toString(),e.setAttribute("hidden","")},a=function(e){return function(i){var o=i.adminUsers,s=i.kickedUsers,a=i.bannedUsers;o.map(createUserItem(e,u)).forEach(function(e){return t.appendChild(e)}),s.map(createKickedUserItem(e,u)).filter(Boolean).forEach(function(e){return r.appendChild(e)}),a.map(createUserItem(e,u,"remove ban",removePermission)).forEach(function(e){return n.appendChild(e)})}};userService.user.subscribe(function(e){return e?void getUsers(e.id).then(a(e.id)).catch(u):void s()})});