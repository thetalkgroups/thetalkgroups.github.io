var EventEmitter=function(){function e(){this.nextId=0;this.subscribers=[]}e.prototype.subscribe=function(e){var t=this;var r=this.nextId;this.nextId+=1;if(this.value!==undefined){e(this.value)}this.subscribers.push({id:r,func:e});return function(){t.subscribers=t.subscribers.filter(function(e){var t=e.id;return t!==r})}};e.prototype.next=function(e){var t=this;this.value=e;this.subscribers.forEach(function(e){var r=e.func;return r(t.value)})};return e}();var config={apiKey:"AIzaSyAjSDRU_Sl8DbTftnDghDsZJsxlAEvQpxE",authDomain:"fir-auth-test-fe62c.firebaseapp.com",databaseURL:"https://fir-auth-test-fe62c.firebaseio.com"};var providers={google:new firebase.auth.GoogleAuthProvider,twitter:new firebase.auth.TwitterAuthProvider,facebook:new firebase.auth.FacebookAuthProvider};firebase.initializeApp(config);var UserService=function(){function e(){var e=this;this.user=new EventEmitter;if(!Object.keys(localStorage).find(function(e){return e.startsWith("firebase")})){this.user.next(null)}firebase.auth().onAuthStateChanged(function(t){var r=t.displayName,n=t.photoURL,i=t.email,a=t.uid;return e.user.next({id:a,name:r,photo:n,email:i})})}e.prototype.signIn=function(e){return firebase.auth().signInWithPopup(providers[e])};e.prototype.signOut=function(){this.user.next(null);return firebase.auth().signOut()};return e}();var clearItemsFromCahce=function(){return Object.keys(localStorage).filter(function(e){return e.startsWith("/item")}).forEach(function(e){return localStorage.removeItem(e)})};var userService=new UserService;var isParentOf=function(e,t){if(e.nodeName==="HTML")return false;if(e.matches(t))return true;return isParentOf(e.parentNode,t)};if("serviceWorker"in navigator){navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(function(e){console.log("service worker registered");e.update()})}window.addEventListener("load",function(){var e=document.querySelector(".navigation");var t=document.querySelector(".header");var r=document.querySelector(".breadcrumb");var n=document.querySelector(".wrapper");var i=document.querySelector(".header__top-bar__open-nav-button");var a=document.querySelector(".navigation__close-nav-button");var o=document.querySelector(".header__top-bar__user-name");var s=document.querySelector(".header__top-bar__sign-in-button");var c=document.querySelector(".header__user");var u=document.querySelector(".header__user__name");var d=document.querySelector(".header__user__email");var l=document.querySelector(".header__user__photo");var f=document.querySelector(".header__user__sign-out-button");s.hidden=false;var h=function(){e.classList.add("open");setTimeout(function(){return document.addEventListener("click",m)})};var m=function(e){var t=e.target;if(isParentOf(t,".navigation"))return;v()};var v=function(){e.classList.remove("open");document.removeEventListener("click",m)};var p=72;var g=r||n;var b=16;var y=function(){var e=document.body.getBoundingClientRect().right*headerImageHWRatio;var r=e-p;var n=window.scrollY;if(n>r){t.style.top=-r+"px";g.style.marginTop=e+b+"px";t.classList.add("small")}else{g.removeAttribute("style");t.classList.remove("small")}};var _=function(e){if(!e){s.hidden=false;o.hidden=true;c.classList.add("not-signed-in")}else{s.hidden=true;o.hidden=false;c.classList.remove("not-signed-in");o.innerText=e.name;u.innerText=e.name;d.innerText=e.email;l.src=e.photo}};var S=true;var L=function(){c.hidden=false;if(S){setTimeout(function(){return document.addEventListener("click",I)});S=false}};var I=function(e){e.preventDefault();if(isParentOf(e.target,".header__user"))return;S=true;c.hidden=true;document.removeEventListener("click",I)};var E=function(){clearItemsFromCahce();I({target:document.body,preventDefault:function(){return null}});userService.signOut()};userService.user.subscribe(_);window.addEventListener("scroll",y);i.addEventListener("click",h);a.addEventListener("click",v);f.addEventListener("click",E);o.addEventListener("click",L)});var HOST="https://83.93.98.21:8000";var setItemToCache=function(e,t){return localStorage.setItem("/item"+e.replace("/sticky","")+"/"+t._id,JSON.stringify(t))};var getItemFromCache=function(e,t){return JSON.parse(localStorage.getItem("/item"+e.replace("/sticky","")+"/"+t))};var getPage=function(){var e=1;var t=location.search.match(/page=(\d+)/);if(t)e=parseInt(t[1],10)||1;return e};var List=function(){function e(e){this.prefix=e}e.prototype.setUserId=function(e){this.userId=e};e.prototype.getItems=function(e){var t=this;return this.listItems(e).then(function(e){var r=e.ids,n=e.numberOfPages;var i=[];var a=[];r.forEach(function(e){var r=getItemFromCache(t.prefix,e);if(r)i.push(r);else a.push(e)});if(a.length===0)return{items:i,numberOfPages:n};return t.fetchItems(a).then(function(e){e.forEach(function(e){return setItemToCache(t.prefix,e)});return{items:i.concat(e),numberOfPages:n}})})};e.prototype.listItems=function(e){return fetch(HOST+this.prefix+"/list/"+e,{headers:{Authorization:this.userId||"UNSET"}}).then(function(e){if(!e.ok)return e.text().then(function(e){throw e});return e.json()})};e.prototype.fetchItems=function(e){return fetch(HOST+this.prefix+"/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.userId||"UNSET"},body:JSON.stringify(e)}).then(function(e){if(!e.ok)return e.text().then(function(e){throw e});return e.json()})};return e}();var initPagination=function(e,t,r,n){var i=0;var a=document.querySelector(".pagination__prev");var o=document.querySelector(".pagination__next");var s=document.querySelector(".pagination__page");var c=function(){if(e===1)a.classList.add("disabled");else a.classList.remove("disabled");if(e===t)o.classList.add("disabled");else o.classList.remove("disabled");history.pushState(null,null,getUrlWithPage(e));s.innerHTML=e+" of "+t};window.addEventListener("popstate",function(){if(i===0){history.back()}else{i-=1;e=getPage();c();r(e).catch(n)}});a.onclick=function(){if(a.classList.contains("disabled"))return;e-=1;c();i+=1;r(e).catch(n)};o.onclick=function(){if(o.classList.contains("disabled"))return;e+=1;c();i+=1;r(e).catch(n)};c()};var getUrlWithPage=function(e){var t=new URL(location.href);if(e===1){t.search=t.search.replace(/&?page=\d+/,"")}else if(!t.search.match("page=")){t.search+=(t.search?"&":"")+"page="+e}else{t.search=t.search.replace(/page=\d+/,"page="+e)}return t.toString()};var normalList=new List(prefix);var stickyList=new List(prefix+"/sticky");var pageMatch=location.search.match(/page=(\d+)/);var page=1;if(pageMatch)page=parseInt(pageMatch[1],10)||1;var listItemTemplate;var createListItemElement=function(e){var t=document.createElement("article");t.appendChild(listItemTemplate.content.cloneNode(true));var r=t.querySelector(".list-item__name");var n=t.querySelector(".list-item__date");var i=t.querySelector(".list-item__title");t.className="list-item";r.innerText=e.user.name;n.innerText=moment(e.date).fromNow();i.innerText=e.title;i.href="item.html?id="+e._id;return t};window.addEventListener("load",function(){var e=document.querySelector(".list__normal");var t=document.querySelector(".list__sticky");var r=document.querySelector(".list-header__add-item");var n=document.querySelector(".spinner");var i=document.querySelector(".list");var a=document.querySelector(".pagination");var o=document.querySelector(".error");var s=document.querySelector(".error__message");listItemTemplate=document.getElementById("list-item");var c=function(e){console.error(e);o.removeAttribute("hidden");s.innerHTML=e.constructor.name.endsWith("Error")?e.message:e.toString();i.setAttribute("hidden","");a.setAttribute("hidden","");r.setAttribute("hidden","")};var u=function(r){var i=setTimeout(function(){return n.removeAttribute("hidden")},100);t.innerHTML="";e.innerHTML="";return stickyList.getItems(r).then(function(a){a.items.map(createListItemElement).forEach(function(e){return t.appendChild(e)});return normalList.getItems(r).then(function(t){clearTimeout(i);n.setAttribute("hidden","");t.items.map(createListItemElement).forEach(function(t){return e.appendChild(t)});return a.numberOfPages})})};u(page).then(function(e){if(e===1||e===0){a.setAttribute("hidden","")}else{initPagination(page,e,u,c)}}).catch(c);userService.user.subscribe(function(e){var t=e?e.id:"UNSET";stickyList.setUserId(t);normalList.setUserId(t);if(!e){r.hidden=true;return}r.hidden=false})});