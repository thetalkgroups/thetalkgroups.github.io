var EventEmitter=function(){function e(){this.nextId=0,this.subscribers=[]}return e.prototype.subscribe=function(e){var t=this,n=this.nextId;return this.nextId+=1,void 0!==this.value&&e(this.value),this.subscribers.push({id:n,func:e}),function(){t.subscribers=t.subscribers.filter(function(e){var t=e.id;return t!==n})}},e.prototype.next=function(e){var t=this;this.value=e,this.subscribers.forEach(function(e){var n=e.func;return n(t.value)})},e}(),firebaseAuthScript=document.getElementById("firebase-auth"),providers,UserService=function(){function e(){var e=this;this.user=new EventEmitter,firebaseAuthScript.onload=function(){var t={apiKey:"AIzaSyAjSDRU_Sl8DbTftnDghDsZJsxlAEvQpxE",authDomain:"fir-auth-test-fe62c.firebaseapp.com",databaseURL:"https://fir-auth-test-fe62c.firebaseio.com"};providers={google:new firebase.auth.GoogleAuthProvider,twitter:new firebase.auth.TwitterAuthProvider,facebook:new firebase.auth.FacebookAuthProvider},firebase.initializeApp(t),firebase.auth().onAuthStateChanged(function(t){var n=t.displayName,r=t.photoURL,i=t.email,o=t.uid;return e.user.next({id:o,name:n,photo:r,email:i})})}}return e.prototype.signIn=function(e){return firebase.auth().signInWithPopup(providers[e])},e.prototype.signOut=function(){return this.user.next(null),firebase.auth().signOut()},e}(),clearItemsFromCahce=function(){return Object.keys(localStorage).filter(function(e){return e.startsWith("/item")}).forEach(function(e){return localStorage.removeItem(e)})},userService=new UserService,isParentOf=function(e,t){return"HTML"!==e.nodeName&&(!!e.matches(t)||isParentOf(e.parentNode,t))};"matches"in HTMLElement.prototype||(HTMLElement.prototype.matches=HTMLElement.prototype.msMatchesSelector),"serviceWorker"in navigator?navigator.serviceWorker.register("/service-worker.js",{scope:"/"}).then(function(e){console.log("service worker registered"),e.onupdatefound=function(){console.log("new service worker found")}}):console.warn("service worker is not supported :-("),window.addEventListener("load",function(){var e=document.querySelector(".navigation"),t=document.querySelector(".header"),n=document.querySelector(".breadcrumb"),r=document.querySelector(".wrapper"),i=document.querySelector(".header__top-bar__open-nav-button"),o=document.querySelector(".navigation__close-nav-button"),a=document.querySelector(".header__top-bar__user-name"),s=document.querySelector(".header__top-bar__sign-in-button"),c=document.querySelector(".header__user"),u=document.querySelector(".header__user__name"),d=document.querySelector(".header__user__email"),l=document.querySelector(".header__user__photo"),m=document.querySelector(".header__user__sign-out-button"),h=document.querySelector(".header__img"),f=document.createElement("img");f.onload=function(){t.insertBefore(f,h),h.setAttribute("hidden","")},f.className="header__img big",f.src=headerImageSrc,s.hidden=!1;var p=function(){e.classList.add("open"),setTimeout(function(){return document.addEventListener("click",g)})},g=function(e){var t=e.target;isParentOf(t,".navigation")||v()},v=function(){e.classList.remove("open"),document.removeEventListener("click",g)},y=72,b=n||r,_=16,S=function(){var e=document.body.getBoundingClientRect().right*headerImageHWRatio,n=e-y,r=window.scrollY;r>n?(t.style.top=-n+"px",b.style.marginTop=e+_+"px",t.classList.add("small")):(b.removeAttribute("style"),t.classList.remove("small"))},L=function(e){e?(s.hidden=!0,a.hidden=!1,c.classList.remove("not-signed-in"),a.innerText=e.name,u.innerText=e.name,d.innerText=e.email,l.src=e.photo):(s.hidden=!1,a.hidden=!0,c.classList.add("not-signed-in"))},E=!0,I=function(){c.hidden=!1,E&&(setTimeout(function(){return document.addEventListener("click",w)}),E=!1)},w=function(e){e.preventDefault(),isParentOf(e.target,".header__user")||(E=!0,c.hidden=!0,document.removeEventListener("click",w))},T=function(){clearItemsFromCahce(),w({target:document.body,preventDefault:function(){return null}}),userService.signOut()};userService.user.subscribe(L),window.addEventListener("scroll",S),i.addEventListener("click",p),o.addEventListener("click",v),m.addEventListener("click",T),a.addEventListener("click",I),function(e,t,n,r,i,o,a){e.GoogleAnalyticsObject=i,e[i]=e[i]||function(){(e[i].q=e[i].q||[]).push(arguments)},e[i].l=1*new Date,o=t.createElement(n),a=t.getElementsByTagName(n)[0],o.async=1,o.src=r,a.parentNode.insertBefore(o,a)}(window,document,"script","https://www.google-analytics.com/analytics.js","ga"),ga("create","UA-85930130-1","auto"),ga("send","pageview")});var HOST="https://83.93.98.21:8000",setItemToCache=function(e,t){return localStorage.setItem("/item"+e.replace("/sticky","")+"/"+t._id,JSON.stringify(t))},getItemFromCache=function(e,t){return JSON.parse(localStorage.getItem("/item"+e.replace("/sticky","")+"/"+t))},getPage=function(){var e=1,t=location.search.match(/page=(\d+)/);return t&&(e=parseInt(t[1],10)||1),e},List=function(){function e(e){this.prefix=e}return e.prototype.setUserId=function(e){this.userId=e},e.prototype.getItems=function(e){var t=this;return this.listItems(e).then(function(e){var n=e.ids,r=e.numberOfPages,i=[],o=[];return n.forEach(function(e){var n=getItemFromCache(t.prefix,e);n?i.push(n):o.push(e)}),0===o.length?{items:i,numberOfPages:r}:t.fetchItems(o).then(function(e){return e.forEach(function(e){return setItemToCache(t.prefix,e)}),{items:i.concat(e),numberOfPages:r}})})},e.prototype.listItems=function(e){return fetch(HOST+this.prefix+"/list/"+e,{headers:{Authorization:this.userId||"UNSET"}}).then(function(e){return e.ok?e.json():e.text().then(function(e){throw e})})},e.prototype.fetchItems=function(e){return fetch(HOST+this.prefix+"/",{method:"POST",headers:{"Content-Type":"application/json",Authorization:this.userId||"UNSET"},body:JSON.stringify(e)}).then(function(e){return e.ok?e.json():e.text().then(function(e){throw e})})},e}(),initPagination=function(e,t,n,r){var i=0,o=document.querySelector(".pagination__prev"),a=document.querySelector(".pagination__next"),s=document.querySelector(".pagination__page"),c=function(){1===e?o.classList.add("disabled"):o.classList.remove("disabled"),e===t?a.classList.add("disabled"):a.classList.remove("disabled"),history.pushState(null,null,getUrlWithPage(e)),s.innerHTML=e+" of "+t};window.addEventListener("popstate",function(){0===i?history.back():(i-=1,e=getPage(),c(),n(e).catch(r))}),o.onclick=function(){o.classList.contains("disabled")||(e-=1,c(),i+=1,n(e).catch(r))},a.onclick=function(){a.classList.contains("disabled")||(e+=1,c(),i+=1,n(e).catch(r))},c()},getUrlWithPage=function(e){var t=new URL(location.href);return 1===e?t.search=t.search.replace(/&?page=\d+/,""):t.search.match("page=")?t.search=t.search.replace(/page=\d+/,"page="+e):t.search+=(t.search?"&":"")+"page="+e,t.toString()},normalList=new List(prefix),stickyList=new List(prefix+"/sticky"),pageMatch=location.search.match(/page=(\d+)/),page=1;pageMatch&&(page=parseInt(pageMatch[1],10)||1);var listItemTemplate,createListItemElement=function(e){var t=document.createElement("article");t.appendChild(listItemTemplate.content.cloneNode(!0));var n=t.querySelector(".list-item__name"),r=t.querySelector(".list-item__date"),i=t.querySelector(".list-item__title");return t.className="list-item",n.innerText=e.user.name,r.innerText=moment(e.date).fromNow(),i.innerText=e.title,i.href="item.html?id="+e._id,t};window.addEventListener("load",function(){var e=document.querySelector(".list__normal"),t=document.querySelector(".list__sticky"),n=document.querySelector(".list-header__add-item"),r=document.querySelector(".spinner"),i=document.querySelector(".list"),o=document.querySelector(".pagination"),a=document.querySelector(".error"),s=document.querySelector(".error__message");listItemTemplate=document.getElementById("list-item");var c=function(e){console.error(e),a.removeAttribute("hidden"),s.innerHTML=e.constructor.name.endsWith("Error")?e.message:e.toString(),i.setAttribute("hidden",""),o.setAttribute("hidden",""),n.setAttribute("hidden","")},u=function(n){var i=setTimeout(function(){return r.removeAttribute("hidden")},100);return t.innerHTML="",e.innerHTML="",stickyList.getItems(n).then(function(o){return o.items.map(createListItemElement).forEach(function(e){return t.appendChild(e)}),normalList.getItems(n).then(function(t){return clearTimeout(i),r.setAttribute("hidden",""),t.items.map(createListItemElement).forEach(function(t){return e.appendChild(t)}),o.numberOfPages})})};u(page).then(function(e){1===e||0===e?o.setAttribute("hidden",""):initPagination(page,e,u,c)}).catch(c),userService.user.subscribe(function(e){var t=e?e.id:"UNSET";return stickyList.setUserId(t),normalList.setUserId(t),e?void(n.hidden=!1):void(n.hidden=!0)})});